Public Function getdomain(ByVal FQDN As String) As String
'
' Excel VBA function returning the domain and top level domain from a Fully Qualified Domain Name
' This function must be saved in a module of Excel and not in a sheet in order to be able to use it from a workbook
' Created on march 2016
' Author: Emmanuel Nicaise for Apalala sprl
' 
' Version 1.4
' Last updated on 29nd of April 2016
'
Dim component() As String 
Dim max As Integer 

component = Split(FQDN, ".") 
' split the FQDN in different parts, the dot being the separator
max = UBound(component) 
If Len(FQDN) > 0 Then
' if the parameter value is not empty, continue the analysis
  If (max > 0) Then 
    If (Val(component(max)) = 0) Then 
        If ((max > 1) And (component(max - 1) = "co" Or component(max - 1) = "com")) Then 
            getdomain = LCase(component(max - 2) + "." + component(max - 1) + "." + component(max)) 
' return 3 last parts of the FQDN, in lowercase, if second component is CO or COM like in .co.uk or co.hk
        Else 
            getdomain = LCase(component(max - 1) + "." + component(max)) 
' return 2 last parts of the FQDN in lowercase in other cases
        End If 
    Else 
' return the string "IP address" if the last part (supposed to be the TLD) has a numeric value higher than 0
' obviously it won't work with a network address but it is unlikely in an URL
        getdomain = "IP Address" 
    End If 
  Else 
' return the FQDN if there is only one component (likely to be an Alias)
    getdomain =  FQDN

  End If 
Else
' if the parameter's value is empty, return an empty value
 getdomain = "" 
End If     
End Function 