Public Function inSubnet(IPaddress As String, Subnet As String, CIDR As Integer) As String
'
' Excel VBA function returning the string "IN" if IPAddress belong to the Subnet and "OUT" if it outside de subnet
' This function must be saved in a module of Excel and not in a sheet in order to be able to use it from a workbook
' As this functions uses also IP2BIN() and isIPv4, they need to be copied as well
' Created on August 2016
' Author: Emmanuel Nicaise for Apalala sprl
'
' Version 1.0
' Last updated on 26 of August 2016
'

If isIPv4(IPaddress) Then
' if the parameter IPaddress value is a valid IPv4 address, continue the analysis
    If isIPv4(Subnet) Then
    ' if the parameter Subnet is a valid IP address, continue the analysis
        If CIDR >= 0 And CIDR < 32 Then
        'if the CIDR value is valid
            If StrComp(Left(IP2BIN(IPaddress), CIDR), Left(IP2BIN(Subnet), CIDR)) = 0 Then
                inSubnet = "IN"
            Else:
                inSubnet = "OUT"
            End If
        Else:
            inSubnet = "ERROR: invalid CIDR"
        End If
    Else:
        inSubnet = "ERROR: invalid Subnet"
    End If
Else:
    inSubnet = "ERROR: invalid IP address"
End If
End Function
